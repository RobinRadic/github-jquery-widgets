/*
Github Profile jquery widget
http://robinradic.github.io/github-profile-widget

Copyright © 2014 Robin Radic - MIT License (http://radic.mit-license.org)

Copyright © 2014 Piotr Lewandowski
Original idea from https://github.com/piotrl/github-profile-widget
Complete javascript rewrite
Uses most of the original CSS
*/
!function(){var e=Handlebars.template,n=Handlebars.templates=Handlebars.templates||{};n["widget.github.profile"]=e({1:function(e){var n,a=this.lambda,t=this.escapeExpression;return'            <div class="profile">\n                <img src="'+t(a(null!=(n=null!=e?e.user:e)?n.avatar_url:n,e))+'" class="avatar">\n                <a href="'+t(a(null!=(n=null!=e?e.user:e)?n.html_url:n,e))+'" class="name">'+t(a(null!=(n=null!=e?e.user:e)?n.name:n,e))+'</a>\n\n                <div class="followMe">\n                    <a href="'+t(a(null!=(n=null!=e?e.user:e)?n.html_url:n,e))+'" class="follow-button">Follow @'+t(a(null!=(n=null!=e?e.user:e)?n.login:n,e))+'</a>\n                    <span class="followers">'+t(a(null!=(n=null!=e?e.user:e)?n.followers:n,e))+"</span>\n                </div>\n            </div>\n"},3:function(e,n,a,t){var s,l='            <div class="languages">\n                ';return s=n["if"].call(e,null!=(s=null!=e?e.options:e)?s.languagesHeaderText:s,{name:"if",hash:{},fn:this.program(4,t),inverse:this.noop,data:t}),null!=s&&(l+=s),l+='\n                <table class="languages-list">\n                    <thead>\n                    <tr>\n                        <th>Language</th>\n                        <th>Lines of code</th>\n                    </tr>\n                    </thead>\n                    <tbody>\n',s=n.each.call(e,null!=e?e.topLanguages:e,{name:"each",hash:{},fn:this.program(6,t),inverse:this.noop,data:t}),null!=s&&(l+=s),l+"                    </tbody>\n                </table>\n            </div>\n"},4:function(e){var n,a=this.lambda,t=this.escapeExpression;return'<span class="header">'+t(a(null!=(n=null!=e?e.options:e)?n.languagesHeaderText:n,e))+"</span>"},6:function(e,n,a,t){var s=n.helperMissing,l=this.escapeExpression;return"                        <tr>\n                            <td>"+l((n.arrayIndex||e&&e.arrayIndex||s).call(e,e,0,{name:"arrayIndex",hash:{},data:t}))+"</td>\n                            <td>\n                                <small>"+l((n.arrayIndex||e&&e.arrayIndex||s).call(e,e,1,{name:"arrayIndex",hash:{},data:t}))+"</small>\n                            </td>\n                        </tr>\n"},8:function(e,n,a,t){var s,l='            <div class="repos">\n                ';return s=n["if"].call(e,null!=(s=null!=e?e.options:e)?s.repositoriesHeaderText:s,{name:"if",hash:{},fn:this.program(9,t),inverse:this.noop,data:t}),null!=s&&(l+=s),l+="\n",s=n.each.call(e,null!=e?e.topRepos:e,{name:"each",hash:{},fn:this.program(11,t),inverse:this.noop,data:t}),null!=s&&(l+=s),l+"            </div>\n"},9:function(e){var n,a=this.lambda,t=this.escapeExpression;return'<span class="header">'+t(a(null!=(n=null!=e?e.options:e)?n.repositoriesHeaderText:n,e))+"</span>"},11:function(e,n,a,t){var s,l="function",r=n.helperMissing,i=this.escapeExpression;return'                    <a href="'+i((s=null!=(s=n.html_url||(null!=e?e.html_url:e))?s:r,typeof s===l?s.call(e,{name:"html_url",hash:{},data:t}):s))+'" title="'+i((s=null!=(s=n.description||(null!=e?e.description:e))?s:r,typeof s===l?s.call(e,{name:"description",hash:{},data:t}):s))+'">\n                        <span class="repo-name">'+i((s=null!=(s=n.name||(null!=e?e.name:e))?s:r,typeof s===l?s.call(e,{name:"name",hash:{},data:t}):s))+'</span><span class="updated">Updated: '+i((s=null!=(s=n.updated_at_formatted||(null!=e?e.updated_at_formatted:e))?s:r,typeof s===l?s.call(e,{name:"updated_at_formatted",hash:{},data:t}):s))+'</span><span class="star">'+i((s=null!=(s=n.stargazers_count||(null!=e?e.stargazers_count:e))?s:r,typeof s===l?s.call(e,{name:"stargazers_count",hash:{},data:t}):s))+"</span>\n                    </a>\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(e,n,a,t){var s,l=this.lambda,r=this.escapeExpression,i='<script type="text/x-handlebars-template">\n    <div data-username="'+r(l(null!=(s=null!=e?e.user:e)?s.login:s,e))+'" class="'+r(l(null!=(s=null!=e?e.options:e)?s.className:s,e))+'">\n';return s=n["if"].call(e,null!=(s=null!=e?e.options:e)?s.showProfile:s,{name:"if",hash:{},fn:this.program(1,t),inverse:this.noop,data:t}),null!=s&&(i+=s),s=n["if"].call(e,null!=(s=null!=e?e.options:e)?s.showLanguages:s,{name:"if",hash:{},fn:this.program(3,t),inverse:this.noop,data:t}),null!=s&&(i+=s),i+="\n",s=n["if"].call(e,null!=(s=null!=e?e.options:e)?s.showRepositories:s,{name:"if",hash:{},fn:this.program(8,t),inverse:this.noop,data:t}),null!=s&&(i+=s),i+"    </div>\n</script>\n"},useData:!0})}(),function(e){e(jQuery,radic)}(function(e,n){n.template.registerHelper("arrayIndex",function(e,n){return e[n]}),e.widget("radic.githubProfile",e.radic.base,{version:"0.0.1",options:{username:null,showProfile:!0,showFollow:!0,showLanguages:!0,showRepositories:!0,template:"widget.github.profile",className:"gh-profile-widget",spinner:!0,spinnerOptions:{},sortBy:"stars",repositoriesHeaderText:"Most starred repositories",repositoriesDateFormat:"lll",repositoriesLimit:5,languagesHeaderText:"Top languages",languagesLimit:7},_spin:function(e){if(this.options.spinner===!0){if("boolean"==typeof e&&e===!1)return this.element.spin(!1);this.element.spin(this.options.spinnerOptions)}},refresh:function(){var e=this;e._spin(),e._getData(function(n){e._spin(!1);var a=e._compile(e.options.template,n);e.element.html(a),e._trigger("completed",null)})},_create:function(){return null!==this.options.username&&_.isString(this.options.username)?(this.refresh(),void 0):(console.error("githubProfile widget has been initialized without the required username option"),void 0)},_sortLanguages:function(e){this._trigger("beforeSortLanguages",null,e);var n=[];for(var a in e)n.push([a,e[a]]);return n.sort(function(e,n){return n[1]-e[1]}),this._trigger("afterSortLanguages",null,n),n.slice(0,this.options.languagesLimit)},_sortRepositories:function(e){this._trigger("beforeSortRepositories",null,e);var n=this;return e.sort(function(e,a){return"stars"==n.options.sortBy?a.stargazers_count-e.stargazers_count:new Date(a.updated_at).getTime()-new Date(e.updated_at).getTime()}),this._trigger("afterSortRepositories",null,e),e.slice(0,n.options.repositoriesLimit)},_getData:function(n){var a=this,t=this.options.username;radic.async.waterfall([function(e){var n=radic.github.users(t,function(n,t){a._trigger("onReceivedUser",null,n),console.info("even more data",n,radic.defined(t)?t:"no second"),e(null,n)});console.log("u2",n)},function(e,n){radic.github.users.repos(t,null,1,100,function(t){a._trigger("onReceivedRepositories",null,t),n(null,{user:e,repos:t})})},function(n,s){n.languages={},radic.async.each(n.repos,function(s,l){s.updated_at_formatted=moment(s.updated_at).format(a.options.repositoriesDateFormat);var r=function(a){e.each(a,function(e,a){"undefined"==typeof n.languages[e]?n.languages[e]=a:n.languages[e]+=a})},i=radic.storage.get("github-profile-widget-languages",{json:!0});i?(n.languages=i.languages,l()):radic.github.repos.languages(t,s.name,function(e){r(e),radic.storage.set("github-profile-widget-languages",{languages:n.languages},{expires:60,json:!0}),l()})},function(){s(null,n)})},function(e,n){e.topRepos=a._sortRepositories(e.repos),n(null,e)},function(e,t){e.topLanguages=a._sortLanguages(e.languages),n(e),t(null)}])},_destroy:function(){this.element.html(""),self._trigger("destroyed",null)},_setOption:function(e,n){"disabled"===e&&this.element.toggleClass("ui-state-disabled",!!n).attr("aria-disabled",n),this._super(e,n)}})});