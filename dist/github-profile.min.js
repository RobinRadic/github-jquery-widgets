/*
Github Profile jquery widget
http://robinradic.github.io/github-profile-widget

Copyright © 2014 Robin Radic - MIT License (http://radic.mit-license.org)

Copyright © 2014 Piotr Lewandowski
Original idea from https://github.com/piotrl/github-profile-widget
Complete javascript rewrite
Uses most of the original CSS
*/
!function(){var e=Handlebars.template,n=Handlebars.templates=Handlebars.templates||{};n["github.profile"]=e({1:function(e){var n,a=this.lambda,t=this.escapeExpression;return'            <div class="profile">\n                <img src="'+t(a(null!=(n=null!=e?e.user:e)?n.avatar_url:n,e))+'" class="avatar">\n                <a href="'+t(a(null!=(n=null!=e?e.user:e)?n.html_url:n,e))+'" class="name">'+t(a(null!=(n=null!=e?e.user:e)?n.name:n,e))+'</a>\n\n                <div class="followMe">\n                    <a href="'+t(a(null!=(n=null!=e?e.user:e)?n.html_url:n,e))+'" class="follow-button">Follow @'+t(a(null!=(n=null!=e?e.user:e)?n.login:n,e))+'</a>\n                    <span class="followers">'+t(a(null!=(n=null!=e?e.user:e)?n.followers:n,e))+"</span>\n                </div>\n            </div>\n"},3:function(e,n,a,t){var s,r='            <div class="languages">\n                ';return s=n["if"].call(e,null!=(s=null!=e?e.options:e)?s.languagesHeaderText:s,{name:"if",hash:{},fn:this.program(4,t),inverse:this.noop,data:t}),null!=s&&(r+=s),r+='\n                <table class="languages-list">\n                    <thead>\n                    <tr>\n                        <th>Language</th>\n                        <th>Lines of code</th>\n                    </tr>\n                    </thead>\n                    <tbody>\n',s=n.each.call(e,null!=e?e.languages:e,{name:"each",hash:{},fn:this.program(6,t),inverse:this.noop,data:t}),null!=s&&(r+=s),r+"                    </tbody>\n                </table>\n            </div>\n"},4:function(e){var n,a=this.lambda,t=this.escapeExpression;return'<span class="header">'+t(a(null!=(n=null!=e?e.options:e)?n.languagesHeaderText:n,e))+"</span>"},6:function(e,n,a,t){var s=n.helperMissing,r=this.escapeExpression;return"                        <tr>\n                            <td>"+r((n.arrayIndex||e&&e.arrayIndex||s).call(e,e,0,{name:"arrayIndex",hash:{},data:t}))+"</td>\n                            <td>\n                                <small>"+r((n.arrayIndex||e&&e.arrayIndex||s).call(e,e,1,{name:"arrayIndex",hash:{},data:t}))+"</small>\n                            </td>\n                        </tr>\n"},8:function(e,n,a,t){var s,r='            <div class="repos">\n                ';return s=n["if"].call(e,null!=(s=null!=e?e.options:e)?s.repositoriesHeaderText:s,{name:"if",hash:{},fn:this.program(9,t),inverse:this.noop,data:t}),null!=s&&(r+=s),r+="\n",s=n.each.call(e,null!=e?e.repositories:e,{name:"each",hash:{},fn:this.program(11,t),inverse:this.noop,data:t}),null!=s&&(r+=s),r+"            </div>\n"},9:function(e){var n,a=this.lambda,t=this.escapeExpression;return'<span class="header">'+t(a(null!=(n=null!=e?e.options:e)?n.repositoriesHeaderText:n,e))+"</span>"},11:function(e,n,a,t){var s,r="function",i=n.helperMissing,l=this.escapeExpression;return'                    <a href="'+l((s=null!=(s=n.html_url||(null!=e?e.html_url:e))?s:i,typeof s===r?s.call(e,{name:"html_url",hash:{},data:t}):s))+'" title="'+l((s=null!=(s=n.description||(null!=e?e.description:e))?s:i,typeof s===r?s.call(e,{name:"description",hash:{},data:t}):s))+'">\n                        <span class="repo-name">'+l((s=null!=(s=n.name||(null!=e?e.name:e))?s:i,typeof s===r?s.call(e,{name:"name",hash:{},data:t}):s))+'</span><span class="updated">Updated: '+l((s=null!=(s=n.updated_at_formatted||(null!=e?e.updated_at_formatted:e))?s:i,typeof s===r?s.call(e,{name:"updated_at_formatted",hash:{},data:t}):s))+'</span><span class="star">'+l((s=null!=(s=n.stargazers_count||(null!=e?e.stargazers_count:e))?s:i,typeof s===r?s.call(e,{name:"stargazers_count",hash:{},data:t}):s))+"</span>\n                    </a>\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(e,n,a,t){var s,r=this.lambda,i=this.escapeExpression,l='<script type="text/x-handlebars-template">\n    <div data-username="'+i(r(null!=(s=null!=e?e.user:e)?s.login:s,e))+'" class="'+i(r(null!=(s=null!=e?e.options:e)?s.className:s,e))+'">\n';return s=n["if"].call(e,null!=(s=null!=e?e.options:e)?s.showProfile:s,{name:"if",hash:{},fn:this.program(1,t),inverse:this.noop,data:t}),null!=s&&(l+=s),s=n["if"].call(e,null!=(s=null!=e?e.options:e)?s.showLanguages:s,{name:"if",hash:{},fn:this.program(3,t),inverse:this.noop,data:t}),null!=s&&(l+=s),l+="\n",s=n["if"].call(e,null!=(s=null!=e?e.options:e)?s.showRepositories:s,{name:"if",hash:{},fn:this.program(8,t),inverse:this.noop,data:t}),null!=s&&(l+=s),l+"    </div>\n</script>\n"},useData:!0})}(),function(e){e(jQuery,radic)}(function(e,n){n.template.registerHelper("arrayIndex",function(e,n){return e[n]}),e.widget("radic.githubProfile",e.radic.base,{version:"0.0.1",options:{username:null,showProfile:!0,showFollow:!0,showLanguages:!0,showRepositories:!0,template:"github.profile",className:"gh-profile-widget",spinner:!0,spinnerOptions:{},sortBy:"stars",repositoriesHeaderText:"Most starred repositories",repositoriesLimit:5,languagesHeaderText:"Top languages",languagesLimit:5},_spin:function(e){if(this.options.spinner===!0){if("boolean"==typeof e&&e===!1)return this.element.spin(!1);this.element.spin(this.options.spinnerOptions)}},refresh:function(){var e=this;e.data={},e._trigger("refresh"),e.element.html(""),e._spin(),e._getData(function(){e._spin(!1),e.repaint(),e._trigger("refreshed")})},repaint:function(){var n=this;n._trigger("repaint"),n.element.html("");var a=n._compile(n.options.template,e.extend({options:n.options},n.data));n.element.html(a),n._trigger("repainted")},_create:function(){return null!==this.options.username&&n.isString(this.options.username)?(this.refresh(),void 0):(console.error("githubProfile widget has been initialized without the required username option"),void 0)},_trigger:function(e,n,a){this._super(e,n,"undefined"==typeof a?[this.options,this.data]:a)},_sortLanguages:function(e){var n=[];for(var a in e)n.push([a,e[a]]);return n.sort(function(e,n){return n[1]-e[1]}),n.slice(0,this.options.languagesLimit)},_sortRepositories:function(e){var n=this;return e.sort(function(e,a){return"stars"==n.options.sortBy?a.stargazers_count-e.stargazers_count:new Date(a.updated_at).getTime()-new Date(e.updated_at).getTime()}),e.slice(0,n.options.repositoriesLimit)},_getData:function(a){var t=this,s=this.options.username;n.async.waterfall([function(e){var a=n.github.users(s,function(n){t.data.user=n,t._trigger("onReceivedUser"),e(null)});console.log("u2",a)},function(e){n.github.users.repos(s,null,1,100,function(n){t.data.repositories=n,t._trigger("onReceivedRepositories"),e(null)})},function(a){t.data.languages={},n.async.each(t.data.repositories,function(a,r){a.updated_at_formatted=radic.time.ago(a.updated_at);var i=function(n){e.each(n,function(e,n){"undefined"==typeof t.data.languages[e]?t.data.languages[e]=n:t.data.languages[e]+=n})},l=n.storage.get("github-profile-widget-languages",{json:!0});l?(t.data.languages=l.languages,r()):n.github.repos.languages(s,a.name,function(e){i(e),n.storage.set("github-profile-widget-languages",{languages:t.data.languages},{expires:60,json:!0}),r()})},function(){a(null)})},function(e){t._trigger("beforeSortRepositories"),t.data.repositories=t._sortRepositories(t.data.repositories),t._trigger("afterSortRepositories"),e(null)},function(e){t._trigger("beforeSortLanguages"),t.data.languages=t._sortLanguages(t.data.languages),t._trigger("afterSortLanguages"),e(null)}],function(){a()})},_destroy:function(){this.element.html(""),this._trigger("destroyed",null)},_setOption:function(e,n){this._super(e,n),"username"===e&&this.refresh()},option:function(e,n){this._super(e,n)}})});